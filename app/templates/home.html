{% extends 'base.html' %}

{% block content %}

<div class="container">

    <header>
        <h1>
            Pass Predict
        </h1>
        <h3>
            See a Satellite!
        </h3>
    </header>

    <main>
        <form id="passes-form" autocomplete="off" method="POST" action="{{ url_for('home') }}">
            <!-- Reference: https://github.com/danharrin/alpine-tailwind-components/blob/151fd18324f6a596ad93907e98cc87ca0dc893de/select/index.html -->
            <div
                id="locationSearch"
                x-data="locationSearch()"
                x-init="init()"
                @click.away="closeListbox()"
                @keydown.escape="closeListbox()"
                class="form-group"
            >
                <div class="field">
                    <label for="locationSearch" class="label">Location</label>
                    <input
                        x-model="query"
                        name="locationQuery"
                        @input.debounce.75ms="fetchLocations()"
                        @focus="fetchLocations()"
                        @keydown.arrow-down="focusNextResult()"
                        @keydown.arrow-up="focusPreviousResult()"
                        @keydown.enter.stop.prevent="selectResult()"
                        type="search"
                        class="input"
                        placeholder="New York, NY"
                        required
                    />
                    <div
                        class="autocomplete-result"
                        x-show="open"
                    >
                        <ul
                        class="autocomplete-result-list"
                        @keydown.arrow-down="focusNextResult()"
                        @keydown.arrow-up="focusPreviousResult()"
                        @keydown.enter.stop.prevent="selectResult()"
                        tabindex="-1"
                        >
                        <template x-for="(item, index) in data" :key="index">
                            <li
                            class="autocomplete-result-item"
                            :id="name + '-result-' + index"
                            @click="selectResult()"
                            @mouseenter="focusedIndex = index"
                            @mouseleave="focusedIndex = null"
                            role="option"
                            :aria-selected="focusedIndex === index"
                            :class="{ 'focused-result' : index === focusedIndex }"
                            x-html="markQuerySubstring(query, item.name)"
                            x-on= class="location-result-item"
                            ></li>
                        </template>
                        </ul>
                    </div>
                </div>
                <input type="hidden" name="lat" x-bind:value="data[selectedIndex].lat" />
                <input type="hidden" name="lon" x-bind:value="data[selectedIndex].lon" />
                <input type="hidden" name="h" x-bind:value="data[selectedIndex].h" />
                <input type="hidden" name="name" x-bind:value="data[selectedIndex].name" />
            </div>

            <div class="field">
                <label for="satid" class="label">Select satellite</label>
                <span class="select">
                    <select name="satid">
                        {% for satellite in satellites %}
                            <option value={{ satellite.id }}>{{ satellite.name }}</option>
                        {% endfor %}
                    </select>
                </span>
            </div>

            <div class="buttons">
                <button id="submit" type="submit" class="button is-primary mr-5">Submit</button>
                <button id="reset" type="reset" class="button">Reset</button>
            </div>
        </form>
    </main>

    <footer class="footer-container">
        <div class="footer-item">
            <a href="{{ url_for('about') }}">About</a>
        </div>
    </footer>

</div>
{% endblock content %}

{% block javascript %}
<script src="{{ url_for('static', path='dist/home.js') }}"></script>
{% endblock javascript %}