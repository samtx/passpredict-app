{% extends 'base.html' %}

{% block title %} Pass Predict {% endblock title %}

{% block content %}

    <header>
        <h1 class="title is-size-1">
            Pass Predict
        </h1>
        <h3 class="subtitle is-size-3">
            See a Satellite!
        </h3>
    </header>

    <main>
        <form
            id="passes-form"
            autocomplete="off"
            method="POST"
            action="{{ url_for('home') }}"
        >
            <!-- Reference: https://github.com/danharrin/alpine-tailwind-components/blob/151fd18324f6a596ad93907e98cc87ca0dc893de/select/index.html -->
            <div
                x-data="passesFormComponent()"
                x-init="init()"
                @reset="reset()"
                id="locationSearch"
                @click.away="closeListbox()"
                @keydown.escape="closeListbox()"
                class="form-group"
            >
                <div class="field">
                    <label for="locationSearch" class="label">Location</label>
                    <input
                        x-model="query"
                        name="locationQuery"
                        @input.debounce.50ms="fetchLocations()"
                        @focus="fetchLocations()"
                        @keydown.arrow-down="focusNextResult()"
                        @keydown.arrow-up="focusPreviousResult()"
                        @keydown.enter.stop.prevent="selectResult()"
                        @reset="reset()"
                        type="search"
                        class="input"
                        placeholder="New York, NY"
                        required
                    />
                    <div
                        class="autocomplete-result"
                        x-show="open"
                    >
                        <ul
                        class="autocomplete-result-list"
                        @keydown.arrow-down="focusNextResult()"
                        @keydown.arrow-up="focusPreviousResult()"
                        @keydown.enter.stop.prevent="selectResult()"
                        tabindex="-1"
                        >
                        <template x-for="(item, index) in data" :key="index">
                            <li
                            class="autocomplete-result-item"
                            :id="name + '-result-' + index"
                            @click="selectResult()"
                            @mouseenter="focusedIndex = index"
                            @mouseleave="focusedIndex = null"
                            role="option"
                            :aria-selected="focusedIndex === index"
                            :class="{ 'focused-result' : index === focusedIndex }"
                            x-html="item.name"
                            x-on="class='location-result-item'"
                            ></li>
                        </template>
                        </ul>
                    </div>
                    <div class="latlon-result" x-show="(selectedIndex != null) && !open">
                        <span class="latlon">Latitude:</span> <span x-text="selectedIndex ? parseFloat(data[selectedIndex].lat).toFixed(4) : 'n/a' "></span>&deg;
                        &nbsp; &nbsp;
                        <span class="latlon">Longitude:</span> <span x-text="selectedIndex ? parseFloat(data[selectedIndex].lon).toFixed(4) : 'n/a' "></span>&deg;
                    </div>
                </div>

                <input type="hidden" name="lat" x-bind:value="data[selectedIndex].lat" />
                <input type="hidden" name="lon" x-bind:value="data[selectedIndex].lon" />
                <input type="hidden" name="h" x-bind:value="data[selectedIndex].h" />
                <input type="hidden" name="name" x-bind:value="data[selectedIndex].name" />

                <div class="field">
                    <label for="satid" class="label">Select satellite</label>
                    <span class="select">
                        <select name="satid">
                            {% for satellite in satellites %}
                                <option value={{ satellite.id }}>{{ satellite.name }}</option>
                            {% endfor %}
                        </select>
                    </span>
                </div>
                <input type="hidden" name="satname" value="" />

                <div class="buttons">
                    <button id="submit" type="submit" class="button is-primary mr-5">Submit</button>
                    <button id="reset" type="reset" @click="reset()" class="button">Reset</button>
                </div>

            </div>
        </form>
    </main>

{% endblock content %}